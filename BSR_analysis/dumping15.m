ddate = input('Date: ', 's');

query_template = [ 'SELECT tid, name, bbuy, bsell, bnet, ratio ' ...
                    'FROM (SELECT company_id AS tid, bbuy, bsell, bbuy+bsell AS bnet, (bbuy+bsell)/(bbuy-bsell)  AS ratio '...
                          'FROM (SELECT company_id, SUM(tnet) AS bbuy '...
                                'FROM bstop15 '...
                                'WHERE tnet > 0 AND date="%s" '...
                                'GROUP BY company_id) AS a '...
                          'JOIN    (SELECT company_id as iid, SUM(tnet) AS bsell '...
                                'FROM bstop15 '...
                                'WHERE tnet < 0 AND date="%s" '...
                                'GROUP BY company_id) AS b '...
                          'ON  a.company_id = b.iid '... 
                          'WHERE bbuy != bsell * -1 AND bbuy-bsell > 1000000 '...
                          'ORDER BY ratio ASC '...
                          'LIMIT 0, 15) AS c '...
                     'JOIN ( SELECT * from companies) AS d '...
                     'ON c.tid = d.id ORDER BY ratio'];
                 
scrsz = get(0, 'ScreenSize');
figure('Position', [50 60 scrsz(3)*0.9 scrsz(4)*0.85]);        

hold on
subplot(2,1,1)
query = sprintf(query_template, ddate, ddate);
result = sql_query(query);
title_s = sprintf('%s TOP15主力賣超排行', ddate);
bsr_ranking_chart(cell2mat(result(:,3)), cell2mat(result(:,4)), cell2mat(result(:,5)), result(:,1), title_s)

t = uitable('data', [result(:,1) result(:,2) result(:,6)],'RowName',[],'ColumnName',[],'Position', [400 10 370 350], 'ColumnWidth', {80, 200, 80}, 'FontSize', 10);
hold off